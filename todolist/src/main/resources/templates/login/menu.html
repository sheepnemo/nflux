<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ToDoList</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style>
        .line {
            float:left;
            padding:0px 10px 0px 10px;
        }
        .banner {
            font-size:400%;
            text-align:center;
        }
        .menu {
            text-decoration:none;
            color:white;
            font-size:70%;
            background-color:black;
            border-radius:15px;
            padding:0px 10px 0px 10px;
        }
        label {
            font-size:80%;
            padding:5px 10px 5px 10px;
        }
        div {
            font-size:150%;
        }
        p {
            font-size:200%;
            text-align:left;
        }
        button {
            text-align:center;
            font-size:70%;
        }
        th, td {
            padding: 10px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="banner">ToDoList</div>
    <div class="line">사용자 :</div>
    <div th:text="${session.sessionName}" class="line"></div>
    <div>
        <input class="menu" type="button" value="등록" onclick="document.all['enroll'].style.display = 'block';
 document.all['search'].style.display = 'none'; document.all['list'].style.display = 'none'; document.all['update'].style.display = 'none';">
        <input class="menu" type="button" value="검색" onclick="document.all['search'].style.display = 'block';
 document.all['enroll'].style.display = 'none'; document.all['list'].style.display = 'block'; document.all['update'].style.display = 'none';">
        <input class="menu" type="button" value="로그아웃" onclick="location.href='/user/logout'">
    </div>
    <div id="enroll" class="form-group" align="left" style="display:block">
        <label for="enrollDate">날짜</label>
        <input type="date" id="enrollDate" name="date">
        <label for="enrollContent">내용</label>
        <input type="text" id="enrollContent" name="content" placeholder="내용">
        <input type="radio" name="enrollCheck" value="완료">완료
        <input type="radio" name="enrollCheck" value="미완료">미완료
        <b>&nbsp;</b>
        <button id="enroll_data" type="submit">등록</button>
    </div>
    <div id="search" class="form-group" align="left" style="display:none">
        <label for="searchDate">날짜</label>
        <input type="date" id="searchDate" name="searchDate">
        <label for="searchContent">내용</label>
        <input type="text" id="searchContent" name="searchContent" placeholder="내용">
        <input type="radio" name="searchCheck" value="완료">완료
        <input type="radio" name="searchCheck" value="미완료">미완료
        <button onclick="deselect()">선택해제</button>
        <b>&nbsp;</b>
        <button id="search_data" type="submit" >검색</button>
    </div>
    <div id="update" class="form-group" align="left" style="display:none">
        <label for="updateDate">날짜</label>
        <input type="date" id="updateDate" name="updateDate" value="">
        <label for="updateContent">내용</label>
        <input type="text" id="updateContent" name="updateContent" placeholder="내용" value="">
        <input type="radio" name="updateCheck" value="완료">완료
        <input type="radio" name="updateCheck" value="미완료">미완료
        <button onclick="deselect()">선택해제</button>
        <b>&nbsp;</b>
        <button id="update_data" type="submit" >수정</button>
        <table id="before_list"></table>
    </div>
    <table id="list" style="display:block"></table>
</div>
</body>
<script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
<script>
    $("#enroll_data").click(()=>{
        const dateData = $('#enrollDate').val();
        const contentData = $('#enrollContent').val();
        const checkData = $('input[name=enrollCheck]:checked').val();
        const data = {"enrollDate" :dateData, "enrollContent" :contentData, "enrollCheck" :checkData};
        $.ajax({
            type:"POST",
            url:"/enroll/data",
            data: data,
            success: function () {
                alert("등록 성공");
            },
            error: function () {
                alert("error");
            }
        })
    })

    $("#search_data").click(()=>{
        const searchDate = $('#searchDate').val();
        const searchContent = $('#searchContent').val();
        const searchCheck = $('input[name=searchCheck]:checked').val();
        const data = {"searchDate" :searchDate, "searchContent" :searchContent, "searchCheck" :searchCheck};
        $.ajax({
            type:"POST",
            url:"/search/data",
            data: data,
            success: function (data) {
                let html = '<thead>' +
                    '<tr>' +
                    '<th>날짜</th>' +
                    '<th>내용</th>' +
                    '<th>확인</th>' +
                    '<th></th>' +
                    '<th></th>' +
                    '</tr>' +
                    '</thead>';

                for (let num in data) {
                    html += '<tr><td>'+data[num].todoDate+'</td>';
                    html += '<td>'+data[num].todoContent+'</td>';
                    html += '<td>'+data[num].todoCheck+'</td>';
                    html += '<td style="display: none">'+data[num].id+'</td>';
                    html += '<td><button id="update" onclick="updateData('+ data[num].id +')">수정</button></td>';
                    html += '<td><button id="delete" onclick="deleteData('+ data[num].id +')">삭제</button></td></tr>';
                    $("#list").html(html);
                }
            },
            error: function (xhr, status, error) {
                console.log("상태값 : " + xhr.status + "\tHttp 에러메시지 : " + xhr.responseText);
            }
        })
    })

    function deleteData(dataId) {
        const data = {"deleteId" :dataId};
        $.ajax({
            type:"POST",
            url:"/delete/data",
            data: data,
            success: function (result) {
                alert("삭제되었습니다.");
                location.href=result;
            },
            error: function() {}
        })
    }

    function updateData(dataId) {
        // document.all['enroll'].style.display = 'none';
        // document.all['search'].style.display = 'none';
        // document.all['list'].style.display = 'none';
        // document.all['update'].style.display = 'block';
        //
        // $('input[name=updateDate]').attr('value', dataDate);
        // $('input[name=updateContent]').attr('value', dataContent);
        //
        // let html = '<thead>' +
        //     '<tr>' +
        //     '<th>날짜</th>' +
        //     '<th>내용</th>' +
        //     '<th>확인</th>' +
        //     '<th></th>' +
        //     '<th></th>' +
        //     '</tr>' +
        //     '</thead>';
        //
        // html += '<tr><td>'+data.dataDate+'</td>';
        // html += '<td>'+data.dataContent+'</td>';
        // html += '<td>'+data.dataCheck+'</td></tr>';
        // $("#before_list").html(html);
    }

    function deselect() {
        $("input:radio[name='searchCheck']").prop('checked', false);
    }

</script>
</html>